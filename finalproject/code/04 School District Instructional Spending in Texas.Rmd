---
title: "04School District Spending in Texas Schools"
author: "Adam Billen"
date: "1/11/2021"
output:
  pdf_document: default
  html_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE}
library(ggforce)
library(haven)
library(ggplot2)
library(dplyr)
library(hexbin)
library(RColorBrewer)
library(tidyverse)
```


```{r}

mydata <- read_dta("\\Users\\adamb\\Documents\\SpendingSD\\finalproject\\code\\school_district (1).dta")

ggplot(data = mydata) +
  geom_point(mapping = aes(x = pbstud, y = instpup),
             show.legend = FALSE) +
  geom_smooth(mapping = aes(x=pbstud, y = instpup)) +
  geom_abline(intercept = 5837.26, slope = -11.52, color = "green") +
  geom_abline(intercept = , slope = ) +
  ggtitle("$ Instructional Expenditures as Predicted by Race") +
  xlab("Percent of Black Students in District") +
  ylab("$ Instructional Expenditure Per Pupil")
  
# Instpup predicted by percent of black students (zoomed in)
ggplot(data = mydata) +
  geom_point(mapping = aes(x = pbstud, y = instpup),
             show.legend = FALSE) +
  geom_smooth(mapping = aes(x=pbstud, y = instpup)) +
  geom_abline(intercept = 5837.26, slope = -11.52, color = "green") +
  geom_abline(intercept = , slope = ) +
  ggtitle("Zoomed In - $ Instructional Expenditures as Predicted by Race") +
  xlab("Percent of Black Students in District") +
  ylab("$ Instructional Expenditure Per Pupil") +
  xlim(0, 50) +
  ylim(2500,10000)

ggplot(data = mydata) +
  geom_point(mapping = aes(x = phstud, y = instpup)) +
  geom_smooth(mapping = aes(x=phstud, y = instpup)) +
  geom_abline(intercept = 5692.4232, slope = .7794, color = "purple") +
  ggtitle("$ Instructional Expenditures as Predicted by Race") +
  xlab("Percent of Hispanic Students in District") +
  ylab("$ Instructional Expenditure Per Pupil")
  
ggplot(data = mydata) +
  geom_point(mapping = aes(x = pwstud, y = instpup)) +
  geom_smooth(mapping = aes(x=pwstud, y = instpup)) +
  geom_abline(intercept = 5530.489, slope = 3.969, color = "blue") +
  ggtitle("$ Instructional Expenditures as Predicted by Race") +
  xlab("Percent of White Students in District") +
  ylab("$ Instructional Expenditure Per Pupil")
  
# pbstud: (a=5837.26, b=-11.52) numbers for pbstud as a result of lm(instpup ~ variable, data = mydata) function
# phstud: (a=5692.4232, b=.7794)
# pwstud: (a=5530.489, b=3.969)

#histograms, log vs breaks = 100
hist(mydata$instpup,breaks = 100,
  main = "Histogram for Instructional Expenditure Per Pupil",
  xlab = "Instructional Expenditure Per Pupil")

"Instructional Expenditure Per Pupil"
hist(log(mydata$instpup))

# Mean Percent of Studets by Race
H <- c(.101, .3842, .5, .1724)
M <- c("Black", "Hispanic", "White", "Other")

barplot(H,names.arg=M, 
        xlab="Race",
        ylab="Percent",
        main="Mean Proportion of Students by Race",
        col = rainbow(4))

#summary statistics / descriptive statistics - add in regression numbers here

# PBSTUD summary
summary(mydata$pbstud)

# instpup predicted by pbstud regression
lm(formula = pbstud ~ instpup, data = mydata)
  mod <- lm(pbstud ~ instpup, data = mydata)
  summary(mod)
  
# PHSTUD summary
summary(mydata$phstud)

# instpup predicted by phstud summary
lm(formula = phstud ~ instpup, data = mydata)
  mod <- lm(phstud ~ instpup, data = mydata)
  summary(mod)

# PWSTUD summary      
summary(mydata$pWstud)

#instpup predicted by pwstud summary
lm(formula = pwstud ~ instpup, data = mydata)
  mod <- lm(pwstud ~ instpup, data = mydata)
  summary(mod)

# INSTPUP summary  
summary(mydata$instpup)

# Controlled Regressions
lm(formula = instpup ~ pbstud + phstud + pwstud + enroll + stear + lowinc, data = mydata)
  mod <- lm(instpup ~ pbstud + phstud + pwstud + enroll + stear + lowinc, data = mydata)
  summary(mod)
  

```
hist(log(mydata$instpup))

#summary of pother
summary(mydata$pother)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
   1.00   15.00   18.00   17.24   20.00   34.00      88 

#testing - figuring out logs, not working yet
ggplot(data = mydata) +
  geom_point(mapping = aes(x = pbstud, y = instpup)) +
  lm(formula = pbstud ~ instpup, data = mydata)
  mod <- lm(pbstud ~ instpup, data = mydata)
  summary(mod)
  
  geom_smooth(mapping = aes(x=pbstud, y = instpup)) +
  geom_abline(intercept = 5837.26, slope = -11.52, color = "green") +
  scale_y_log10()

#size plot
ggplot(data = mydata) +
  geom_point(mapping = aes(x = enroll, y = instpup),
             show.legend = FALSE) +
  geom_smooth(mapping = aes(x=enroll, y = instpup))
  
  
  
# histogram
hist(mydata$instpup,breaks = 100)
hist(log(mydata$instpup))

geom_histogram(mydata$instpup) +
  scale_x_log10()





hist(log(mydata$pbstud))

hist(log(mydata$phstud))

hist(log(mydata$pwstud))

loghist(mydata$instpup)

  hist(mydata$instpup,freq = T)

hist(mydata$pbstud,breaks = 50) +
  
  hist(mydata$pbstud,freq = T)
  
  
hist(mydata$phstud,breaks = 50)
  hist(mydata$phstud,freq = T)
  
hist(mydata$pwstud,breaks = 50)
  hist(mydata$pwstud,freq = T)
